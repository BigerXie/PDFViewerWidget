$("body").append('<script type="text/javascript" src="../Common/extensions/PDFViewerWidget/ui/pdfviewer/jslibrary/pdf.js">\x3c/script>');pdfjsLib.GlobalWorkerOptions.workerSrc="../Common/extensions/PDFViewerWidget/ui/pdfviewer/jslibrary/pdf.worker.js";
TW.Runtime.Widgets.pdfviewer=function(){function C(a,e){"string"===typeof a.dest?f.getDestination(a.dest).then(b=>{D(a,b,e)}):D(a,a.dest,e)}function D(b,e,d){f.getPageIndex(e[0]).then(c=>{c={page:parseInt(c)+1};switch(e[1].name){case "FitH":c.Y=e[2];break;case "XYZ":c.Y=e[3];break;default:c.Y=-1}$(".widget-pdfviewer-outline_select-"+a).append("<option value='"+JSON.stringify(c)+"'>"+d+b.title+"</option>");for(c=0;c<b.items.length;c++)C(b.items[c],d+"&nbsp;&nbsp;&nbsp;")})}function E(){switch(w){case "page":var b=
$(".widget-pdfviewer-container-"+a).width()-30,e=$(".widget-pdfviewer-container-"+a).height();h=Math.min(b/r.width,e/r.height);break;case "width":h=($(".widget-pdfviewer-container-"+a).width()-30)/r.width;break;case "+":h=1.5*z;break;case "-":h=z/1.5;break;default:h=parseFloat(w)/100}for(b=1;b<=f.numPages;b++)g[b]=t[b].getViewport({scale:h}),m[b].height=g[b].height,m[b].width=g[b].width,l[b]=l[b-1]+m[b].height;x||(b=$(".widget-pdfviewer-container-"+a)[0].scrollHeight,$(".widget-pdfviewer-container-"+
a).scrollTop(F/G*b));var d=n;t[k].render({canvasContext:y[k],viewport:g[k]}).promise.then(function(){$(".widget-pdfviewer-page_fitpage-"+a).prop("disabled",!1);$(".widget-pdfviewer-page_fitwidth-"+a).prop("disabled",!1);$(".widget-pdfviewer-page_plus-"+a).prop("disabled",!1);$(".widget-pdfviewer-page_minus-"+a).prop("disabled",!1);d===n&&(H(),A(k-1,-1,d),A(k+1,1,d))})}function A(a,e,d){d===n&&1<=a&&a<=f.numPages&&t[a].render({canvasContext:y[a],viewport:g[a]}).promise.then(function(){d===n&&(H(),
A(a+e,e,d))})}function H(){p++;var b=$(".widget-pdfviewer-loading-"+a).width();b*=p/f.numPages;$(".widget-pdfviewer-loading-progress-"+a).width(b);$(".widget-pdfviewer-loading-progress-"+a).text(p);p===f.numPages&&($(".widget-pdfviewer-loading-progress-"+a).width(0),$(".widget-pdfviewer-loading-progress-"+a).text(""),x&&($(".widget-pdfviewer-page_num-"+a).text(q+": 1/"+f.numPages),u.jqElement.triggerHandler("Loaded")),x=!1)}function v(b){$(".widget-pdfviewer-page_fitpage-"+a).prop("disabled",!0);
$(".widget-pdfviewer-page_fitwidth-"+a).prop("disabled",!0);$(".widget-pdfviewer-page_plus-"+a).prop("disabled",!0);$(".widget-pdfviewer-page_minus-"+a).prop("disabled",!0);n=(new Date).getTime()+"_"+Math.floor(1E3*Math.random());F=$(".widget-pdfviewer-container-"+a).scrollTop();G=$(".widget-pdfviewer-container-"+a)[0].scrollHeight;z=h;p=0;l=[0];h=0;w=b;E()}var u=this,a=(new Date).getTime()+"_"+Math.floor(1E3*Math.random()),I=[10,25,50,75,100,125,150,200,400],f,t=[],m=[],y=[],g=[],B=0,p=0,l=[0],h=
0,w="width",x,r,k=1,n=(new Date).getTime()+"_"+Math.floor(1E3*Math.random()),F,G,z,q=TW.Runtime.convertLocalizableString("[[PDFViewerWidget.pdfviewer.page]]","Page"),J=TW.Runtime.convertLocalizableString("[[PDFViewerWidget.pdfviewer.fitpage]]","Fit Page"),K=TW.Runtime.convertLocalizableString("[[PDFViewerWidget.pdfviewer.fitwidth]]","Fit Width"),L=TW.Runtime.convertLocalizableString("[[PDFViewerWidget.pdfviewer.error]]","The file is not available or is not a valid PDF document");this.runtimeProperties=
function(){return{supportsAutoResize:!0,needsDataLoadingAndError:!1}};this.renderHtml=function(){return'<div class="widget-content widget-pdfviewer widget-pdfviewer-'+a+'">  <div class="widget-pdfviewer-page">    <button class="widget-pdfviewer-page_num widget-pdfviewer-page_num-'+a+'">'+q+':</button>    <select class="widget-pdfviewer-page_select widget-pdfviewer-page_select-'+a+'"></select>    <select class="widget-pdfviewer-outline_select widget-pdfviewer-outline_select-'+a+'"></select>    <button class="widget-pdfviewer-page_loading widget-pdfviewer-page_loading-'+
a+'"></button>    <button class="widget-pdfviewer-page_fitpage widget-pdfviewer-page_fitpage-'+a+'">'+J+'</button>    <button class="widget-pdfviewer-page_fitwidth widget-pdfviewer-page_fitwidth-'+a+'">'+K+'</button>    <button class="widget-pdfviewer-page_plus widget-pdfviewer-page_plus-'+a+'">+</button>    <select class="widget-pdfviewer-page_zoom widget-pdfviewer-page_zoom-'+a+'"></select>    <button class="widget-pdfviewer-page_minus widget-pdfviewer-page_minus-'+a+'">-</button>  </div>  <div class="widget-pdfviewer-container widget-pdfviewer-container-'+
a+'"></div>  <div class="widget-pdfviewer-loading widget-pdfviewer-loading-'+a+'">    <span class="widget-pdfviewer-loading-progress widget-pdfviewer-loading-progress-'+a+'"></span>  </div></div>'};this.afterRender=function(){var b=!1,e=u.getProperty("showSizingButtons");$(".widget-pdfviewer-page_zoom-"+a).append("<option value=''></option>");I.forEach(function(b){$(".widget-pdfviewer-page_zoom-"+a).append("<option value='"+b+"'>"+b+"%</option>")});$(".widget-pdfviewer-page_select-"+a).change(function(){if(f){var b=
parseInt($(this).val());k=b;$(".widget-pdfviewer-page_num-"+a).text(q+": "+b+"/"+f.numPages);$(".widget-pdfviewer-container-"+a).scrollTop(l[b-1]+5)}});$(".widget-pdfviewer-outline_select-"+a).change(function(){if(f){b=!0;var d=JSON.parse($(this).val()),c=g[d.page].height-d.Y*g[d.page].scale;k=d.page;$(".widget-pdfviewer-page_num-"+a).text(q+": "+d.page+"/"+f.numPages);$(".widget-pdfviewer-container-"+a).scrollTop(l[d.page-1]+5+c)}});$(".widget-pdfviewer-page_fitpage-"+a).click(function(){f&&v("page")}).css("display",
e?"inherit":"none");$(".widget-pdfviewer-page_fitwidth-"+a).click(function(){f&&v("width")}).css("display",e?"inherit":"none");$(".widget-pdfviewer-page_plus-"+a).click(function(){f&&v("+")}).css("display",e?"inherit":"none");$(".widget-pdfviewer-page_minus-"+a).click(function(){f&&v("-")}).css("display",e?"inherit":"none");$(".widget-pdfviewer-page_zoom-"+a).change(function(){var a=$(this).val();f&&a&&v(a);$(this).val("")}).css("display",e?"inherit":"none");$(".widget-pdfviewer-container-"+a).height("calc(100% - 50px)").scroll(function(){for(var d=
1,c=$(".widget-pdfviewer-container-"+a).scrollTop();l[d]<c;)d++;k=d;$(".widget-pdfviewer-page_num-"+a).text(q+": "+d+"/"+f.numPages);$(".widget-pdfviewer-page_select-"+a).val(d);b||$(".widget-pdfviewer-outline_select-"+a+" option").each(function(){var b=JSON.parse($(this).val());c>l[b.page-1]+5+(g[b.page].height-b.Y*g[b.page].scale)&&$(".widget-pdfviewer-outline_select-"+a).val($(this).val())});b=!1})};this.resize=function(a,e){};this.serviceInvoked=function(b){if("Load"===b){$(".widget-pdfviewer-container-"+
a).empty().scrollTop(0);$(".widget-pdfviewer-page_num-"+a).text(q+": ");$(".widget-pdfviewer-page_select-"+a).empty();$(".widget-pdfviewer-outline_select-"+a).empty();f=void 0;t=[];m=[];y=[];g=[];p=B=0;l=[0];h=0;w="width";x=!0;r=void 0;k=1;b=u.getProperty("url");var e=u.getProperty("debugMode");b=pdfjsLib.getDocument(b);b.onProgress=function(b){e&&console.log("PDFViewer - loading -> "+b.loaded+"/"+b.total);$(".widget-pdfviewer-page_loading-"+a).text((b.loaded/1048576).toFixed(2)+" MB")};b.promise.then(function(b){$(".widget-pdfviewer-page_loading-"+
a).text("");for(var c=1;c<=b.numPages;c++)m[c]=document.createElement("canvas"),$(".widget-pdfviewer-container-"+a)[0].appendChild(m[c]),y[c]=m[c].getContext("2d"),$(".widget-pdfviewer-page_select-"+a).append("<option value='"+c+"'>"+c+"</option>"),b.getPage(c).then(function(c){t[c.pageNumber]=c;B++;1===c.pageNumber&&(c=c.getViewport({scale:1}),r={width:c.width,height:c.height});B===b.numPages&&(n=(new Date).getTime()+"_"+Math.floor(1E3*Math.random()),f=b,f.getOutline().then(b=>{if(b){for(var c=0;c<
b.length;c++)C(b[c],"");$(".widget-pdfviewer-outline_select-"+a).css("visibility","visible")}else $(".widget-pdfviewer-outline_select-"+a).css("visibility","hidden")}),E())})},function(b){$(".widget-pdfviewer-container-"+a).append("<h3 style='text-align:center;padding:100px;color:whitesmoke'>"+L+"</h3>");$(".widget-pdfviewer-page_loading-"+a).text("");u.jqElement.triggerHandler("Failed")})}};this.updateProperty=function(a){"url"===a.TargetProperty?this.setProperty("url",a.RawSinglePropertyValue):
"showSizingButtons"===a.TargetProperty&&this.setProperty("showSizingButtons",a.RawSinglePropertyValue)}};